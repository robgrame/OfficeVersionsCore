@page
@model AnalyticsModel
@{
    ViewData["Title"] = "SEO Analytics - Google Search Console";
    ViewData["Description"] = "View Google Search Console analytics and SEO performance metrics";
}

<div class="container my-5">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-2">
                <i class="bi bi-graph-up me-2"></i>SEO Analytics Dashboard
            </h1>
            <p class="text-muted">
                Google Search Console performance metrics and optimization insights
            </p>
        </div>
    </div>

    @if (Model.GscData == null)
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            <strong>No GSC Data Available</strong>
            <p class="mb-0">Google Search Console data has not been imported yet. Please ensure the GSC CSV export file is placed in the data directory.</p>
        </div>
    }
    else
    {
        <!-- Key Metrics Cards -->
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="modern-card text-center">
                    <div class="card-body">
                        <div class="display-4 text-primary mb-2">@Model.GscData.TotalClicks</div>
                        <p class="text-muted mb-0">Total Clicks</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="modern-card text-center">
                    <div class="card-body">
                        <div class="display-4 text-primary mb-2">@Model.GscData.TotalImpressions.ToString("N0")</div>
                        <p class="text-muted mb-0">Total Impressions</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="modern-card text-center">
                    <div class="card-body">
                        <div class="display-4 text-primary mb-2">@Model.AverageCtr.ToString("F2")%</div>
                        <p class="text-muted mb-0">Average CTR</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="modern-card text-center">
                    <div class="card-body">
                        <div class="display-4 text-primary mb-2">@Model.AveragePosition.ToString("F2")</div>
                        <p class="text-muted mb-0">Average Position</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="modern-card text-center">
                    <div class="card-body">
                        <div class="display-4 text-primary mb-2">@Model.GscData.AllQueries.Count</div>
                        <p class="text-muted mb-0">Total Queries</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="modern-card text-center">
                    <div class="card-body">
                        <div class="display-4 text-warning mb-2">@Model.ZeroCtrQueriesCount</div>
                        <p class="text-muted mb-0">Zero CTR Queries</p>
                        <small class="text-muted">Optimization opportunities</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Performing Queries -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="bi bi-star-fill"></i>
                        </div>
                        <div>
                            <h2 class="card-title">Top Performing Queries</h2>
                            <p class="text-muted mb-0">Your best-performing search queries by clicks</p>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Query</th>
                                    <th>Clicks</th>
                                    <th>Impressions</th>
                                    <th>CTR</th>
                                    <th>Position</th>
                                    <th>SEO Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var query in Model.TopQueries)
                                {
                                    <tr>
                                        <td>
                                            <strong>@query.Query</strong>
                                        </td>
                                        <td>@query.Clicks</td>
                                        <td>@query.Impressions.ToString("N0")</td>
                                        <td>
                                            <span class="badge bg-success">@query.CTR.ToString("F2")%</span>
                                        </td>
                                        <td>
                                            @if (query.Position <= 3)
                                            {
                                                <span class="badge bg-primary">@query.Position.ToString("F2")</span>
                                            }
                                            else if (query.Position <= 10)
                                            {
                                                <span class="badge bg-info">@query.Position.ToString("F2")</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">@query.Position.ToString("F2")</span>
                                            }
                                        </td>
                                        <td>
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar" role="progressbar" style="width: @(query.GetSEOScore())%" aria-valuenow="@(query.GetSEOScore())" aria-valuemin="0" aria-valuemax="100">
                                                    @(query.GetSEOScore())
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- High Potential Queries for Optimization -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="bi bi-rocket-takeoff"></i>
                        </div>
                        <div>
                            <h2 class="card-title">High-Potential Optimization Opportunities</h2>
                            <p class="text-muted mb-0">Queries with high impressions but low CTR - great candidates for optimization</p>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Query</th>
                                    <th>Impressions</th>
                                    <th>Clicks</th>
                                    <th>CTR</th>
                                    <th>Position</th>
                                    <th>Optimization Priority</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var query in Model.HighPotentialQueries)
                                {
                                    <tr>
                                        <td>
                                            <strong>@query.Query</strong>
                                        </td>
                                        <td>@query.Impressions.ToString("N0")</td>
                                        <td>@query.Clicks</td>
                                        <td>
                                            <span class="badge bg-warning text-dark">@query.CTR.ToString("F2")%</span>
                                        </td>
                                        <td>@query.Position.ToString("F2")</td>
                                        <td>
                                            @{
                                                var priority = query.GetOptimizationPriority();
                                                var priorityLabel = priority switch
                                                {
                                                    1 => "Top Performer",
                                                    2 => "High",
                                                    3 => "Very High",
                                                    4 => "Medium",
                                                    _ => "Low"
                                                };
                                                var badgeClass = priority switch
                                                {
                                                    1 => "bg-success",
                                                    2 => "bg-info",
                                                    3 => "bg-danger",
                                                    4 => "bg-warning",
                                                    _ => "bg-secondary"
                                                };
                                            }
                                            <span class="badge @badgeClass">@priorityLabel</span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- SEO Recommendations -->
        <div class="row">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="bi bi-lightbulb-fill"></i>
                        </div>
                        <div>
                            <h2 class="card-title">SEO Recommendations</h2>
                            <p class="text-muted mb-0">Data-driven insights for improving your search performance</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="row g-3">
                            @if (Model.AveragePosition > 5)
                            {
                                <div class="col-12">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <strong>Improve Rankings:</strong> Your average position is @Model.AveragePosition.ToString("F2"). Focus on optimizing meta tags and content for your top queries to move from position @Model.AveragePosition.ToString("F2") closer to positions 1-3.
                                    </div>
                                </div>
                            }

                            @if (Model.GscData.AverageCTR < 3)
                            {
                                <div class="col-12">
                                    <div class="alert alert-warning">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        <strong>Improve CTR:</strong> Your average CTR is @Model.GscData.AverageCTR.ToString("F2")%. Optimize your meta descriptions and titles to make them more compelling and encourage more clicks from search results.
                                    </div>
                                </div>
                            }

                            @if (Model.ZeroCtrQueriesCount > 100)
                            {
                                <div class="col-12">
                                    <div class="alert alert-danger">
                                        <i class="bi bi-exclamation-circle me-2"></i>
                                        <strong>Address Zero-CTR Queries:</strong> You have @Model.ZeroCtrQueriesCount queries with zero clicks. These are opportunities to improve your presence. Consider creating or optimizing content for these searches.
                                    </div>
                                </div>
                            }

                            <div class="col-12">
                                <h5>Action Items:</h5>
                                <ul class="mb-0">
                                    <li>Optimize meta tags for top 10 queries</li>
                                    <li>Improve content for queries in positions 4-6</li>
                                    <li>Add schema.org markup for rich snippets</li>
                                    <li>Create content targeting high-impression, zero-CTR queries</li>
                                    <li>Monitor query performance weekly</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .display-4 {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--bs-primary);
    }

    .progress {
        background-color: #e9ecef;
    }

    .progress-bar {
        background-color: var(--bs-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.75rem;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0, 0, 0, 0.02);
    }

    .badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.6rem;
    }
</style>
