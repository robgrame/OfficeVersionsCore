@page
@model OfficeVersionsCore.Pages.Windows.Releases10Model
@{
    ViewData["Title"] = "Windows 10 Releases";
    ViewData["Description"] = "Complete release history of Windows 10 builds and updates.";
}

<div class="container">
    <div class="modern-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="bi bi-windows me-2"></i>
            </div>
            <div>
                <h1 class="card-title">Windows 10 Releases</h1>
                <p class="text-muted mb-0">Complete history of all Windows 10 builds and updates</p>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4 ps-3" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" href="/windows/releases10" role="tab">Windows 10</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="/windows/releases11" role="tab">Windows 11</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="/windows/releases" role="tab">All Releases</a>
            </li>
        </ul>

        <div class="modern-table-container table-responsive">
            <table id="windows10Releases" class="table modern-table" width="100%">
                <thead>
                    <tr>
                        <th><i class="bi bi-tag me-2"></i>Version</th>
                        <th><i class="bi bi-hash me-2"></i>Build</th>
                        <th><i class="bi bi-calendar-event me-2"></i>Release Date</th>
                        <th class="d-none d-md-table-cell"><i class="bi bi-gear me-2"></i>Servicing</th>
                        <th class="d-none d-lg-table-cell"><i class="bi bi-file-text me-2"></i>KB</th>
                        <th class="d-none d-lg-table-cell"><i class="bi bi-shield-check me-2"></i>Security</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data loaded via AJAX -->
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
<script src="~/js/windows-version-sort.js"></script>
<script src="https://cdn.datatables.net/searchbuilder/1.6.0/js/dataTables.searchBuilder.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/searchbuilder/1.6.0/css/searchBuilder.bootstrap5.min.css" />

<script type="text/javascript">
$(document).ready(function() {
    // Register custom sorting type for Windows versions
    $.fn.dataTable.ext.type.order['windows-version-pre'] = function(version) {
        return getWindowsVersionSortValue(version);
    };

    const table = $('#windows10Releases').DataTable({
        processing: true,
        serverSide: false,
        ajax: {
            url: '/api/WindowsVersions/windows10/releases',
            type: 'GET',
            dataType: 'json',
            dataSrc: '',
            error: function(xhr, error, code) {
                console.error('DataTable AJAX error:', error, code);
                Swal.fire({
                    icon: 'error',
                    title: 'Error Loading Data',
                    text: 'Could not load Windows 10 releases data. Please try again later.'
                });
            }
        },
        columns: [
            {
                data: 'version',
                className: 'version-column',
                type: 'windows-version',
                render: function(data) {
                    return data ? `<span class="version-badge">${data}</span>` : '';
                }
            },
            {
                data: 'buildNumber',
                className: 'build-column',
                render: function(data) {
                    return data ? `<code class="build-code">${data}</code>` : '';
                }
            },
            {
                data: 'releaseDate',
                className: 'release-date-column',
                render: function(data) {
                    if (!data) return '';
                    const date = new Date(data);
                    return isNaN(date) ? data : date.toISOString().substring(0,10);
                }
            },
            {
                data: 'servicingOption',
                className: 'd-none d-md-table-cell'
            },
            {
                data: 'kb',
                className: 'd-none d-lg-table-cell',
                render: function(data, type, row) {
                    if (!data) return '-';
                    if (row.url) {
                        return `<a href="${row.url}" target="_blank" rel="noopener">${data}</a>`;
                    }
                    return data;
                }
            },
            {
                data: 'isSecurityUpdate',
                className: 'd-none d-lg-table-cell',
                render: function(data) {
                    return data 
                        ? '<span class="badge bg-danger">Security</span>' 
                        : '<span class="badge bg-secondary">General</span>';
                }
            }
        ],
        order: [[ 0, 'desc' ], [ 2, 'desc' ]],  // Sort by Version (desc) then Release Date (desc)
        pageLength: 25,
        lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
        dom: 'QBlfrtip',  // Add SearchBuilder (Q) to the DOM
        searchBuilder: {
            columns: [0, 1, 4]  // Enable SearchBuilder on Version, Build, KB columns
        },
        drawCallback: function() {
            if (window.bootstrap && bootstrap.Tooltip) {
                const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
                tooltips.forEach(tooltip => new bootstrap.Tooltip(tooltip));
            }
        }
    });
});
</script>

<style>
    .version-badge {
        display: inline-block;
        padding: .35rem .6rem;
        font-weight: 600;
        font-size: .85rem;
        border-radius: .65rem;
        background-color: rgba(13,110,253,.15);
        color: var(--bs-primary);
    }
    
    .build-code {
        font-family: monospace;
        padding: .2rem .4rem;
        font-size: .85rem;
        border-radius: .25rem;
        background-color: rgba(13,110,253,.1);
        color: var(--bs-primary);
    }
    
    .nav-tabs .nav-link.active {
        border-bottom: 3px solid var(--bs-primary);
        font-weight: 600;
    }
    
    /* SearchBuilder styling adjustments */
    .dtsb-titleRow {
        background-color: #f8f9fa;
        border-radius: .5rem;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .dtsb-logicalOperator button {
        margin-right: 0.5rem;
    }
</style>
}
